<div class="ao-item-view ao-model-view ao-padding">
    <section>
        <h1 class="mat-h1" style="margin-bottom: 60px;">{{title}}</h1>
        <p *ngIf="description">{{description}}}</p>
        <mat-form-field *ngIf="item && item.attributes">
            <mat-label>Description</mat-label>
            <textarea matInput [(ngModel)]="item.attributes.description" (ngModelChange)="saveItem();"
                placeholder="Type a description for your model"></textarea>
        </mat-form-field>
    </section>

    <section>
        <h2 class="mat-h2">Recipe</h2>
        <p class="mat-body" *ngIf="recipe">This model based on this recipe: <a mat-button
                routerLink="/recipes/{{recipe.id}}">{{ (recipe.attributes.title || recipe.id)}}</a>

        </p>
    </section>
    <section>
        <h2 class="mat-h2">Statistics</h2>
        <div *ngIf="item && item.attributes && item.attributes.training">

            <div>
                <p class="mat-body">
                    <b>Plugins</b><br>
                    Training: {{item.attributes.training && item.attributes.training.plugins.training}} <br>
                    Prediction: {{item.attributes.training && item.attributes.training.plugins.prediction}}<br>
                </p>
                <p class="mat-body">
                    <b>Data</b> <br>
                    Source records: {{item.attributes.training.data.source_records | number}}<br>
                    Training records: {{item.attributes.training.data.training_records | number}}<br>
                    Test records: {{item.attributes.training.data.test_records | number}}<br>
                    Dropped records: {{item.attributes.training.data.dropped_records | number}}<br>
                </p>
            </div>

            <div *ngIf="item.attributes.training.scores">
                <b>Scores</b>
                <div *ngIf="item.attributes.training.scores.log_loss">
                    <p>Log loss: {{item.attributes.training.scores.log_loss}}</p>
                    <p>Accuracy score: {{item.attributes.training.scores.accuracy_score}}</p>
                    <p>Best iteration: {{item.attributes.training.scores.best_iteration}}</p>
                    <p>Best score: learn: {{item.attributes.training.scores.best_score.learn.Logloss}} / validation:
                        {{item.attributes.training.scores.best_score.validation_0.Logloss}}</p>

                </div>
                <div>
                    <div>
                        <b>Classes</b>
                        <div *ngFor="let class of item.attributes.training.data.classes">
                            <p><b>{{class}}</b></p>
                            <div
                                *ngFor="let prop of item.attributes.training.scores.classification_report[class] | keyvalue">
                                <p>{{prop.key}}: {{prop.value | json}}</p>
                            </div>

                        </div>
                    </div>
                    <div style="margin-top: 80px;">
                        <b>Other Classes</b>
                        <div *ngFor="let el of item.attributes.training.scores.classification_report | keyvalue">
                            <div *ngIf="item.attributes.training.data.classes.indexOf(el.key) < 0">
                                <p>{{el.key}}</p>
                                <div
                                    *ngFor="let prop of item.attributes.training.scores.classification_report[el.key] | keyvalue">
                                    {{prop.key}}: {{prop.value | json}}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </div>
    </section>
    <section>
        <h2 class="mat-h2">Alternative models</h2>
        <p class="mat-body">This is the list of all the available trained models using the same recipe. <br>
            The currently deployed model is highlighted in <span class="ao-current-endpoint-model"
                style="display: inline-block; padding: 4px;">this color</span>.</p>
        <p class="mat-body">
            You can create a new endpoints for a model using the "Create endpoints" button next
            to the desired model.
        </p>
        <div class="ao-margin-top" style="max-height: 300px; overflow: auto;">
            <table mat-table [dataSource]="tableModels" class="mat-elevation-z8" style="width: 100%;"
                *ngIf="tableModels">

                <ng-container matColumnDef="title">
                    <th mat-header-cell *matHeaderCellDef> Title </th>
                    <td mat-cell *matCellDef="let element">
                        {{element.attributes.title || element.id}}
                    </td>
                </ng-container>

                <ng-container matColumnDef="kpi0">
                    <th mat-header-cell *matHeaderCellDef> KPI </th>
                    <td mat-cell *matCellDef="let element">
                        <p *ngFor="let kpi of element._aoprivate.kpi">
                            {{kpi.name}}: {{kpi.value}}
                        </p>

                    </td>
                </ng-container>

                <ng-container matColumnDef="updatedAt">
                    <th mat-header-cell *matHeaderCellDef> Updated At </th>
                    <td mat-cell *matCellDef="let element">
                        {{element.attributes.updated_at | date:'dd/MM/yyyy HH:mm:ss'}}
                    </td>
                </ng-container>

                <ng-container matColumnDef="endpoint">
                    <th mat-header-cell *matHeaderCellDef> Endpoint </th>
                    <td mat-cell *matCellDef="let element">
                        <a mat-button (click)="$event.preventDefault(); $event.stopPropagation();"
                            *ngIf="element._aoprivate.endpoints.length > 0"
                            routerLink="/endpoints/{{element._aoprivate.endpoints[0].id}}">{{element._aoprivate.endpoints[0].attributes.title || element._aoprivate.endpoints[0].id}}</a>
                    </td>
                </ng-container>

                <ng-container matColumnDef="actions">
                    <th mat-header-cell *matHeaderCellDef> Actions </th>
                    <td mat-cell *matCellDef="let element">
                        <button mat-raised-button color="primary" *ngIf="element._aoprivate.endpoints.length === 0"
                            (click)="$event.stopPropagation(); $event.preventDefault(); createEndpointForModel(element); ">Create
                            endpoint</button>
                    </td>
                </ng-container>

                <tr mat-header-row
                    *matHeaderRowDef="['title', 'kpi0', 'updatedAt', 'endpoint', 'actions']; sticky: true">
                </tr>
                <tr mat-row *matRowDef="let row; columns: ['title', 'kpi0', 'updatedAt','endpoint', 'actions'];"
                    routerLink="/models/{{row.id}}" class="ao-clickable"
                    [class.ao-current-endpoint-model]="row.id === item.id">
                </tr>
            </table>
        </div>
    </section>



</div>