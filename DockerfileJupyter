FROM eu.gcr.io/analitico-api/analitico-website:base
# we want to copy only requirements and ssl certificates
# execute everything as a new users with restricted access
# create user and change ownership of analitico venv
WORKDIR /home/www/analitico
#Â copy requirements
COPY ./requirements.txt /home/www/analitico
# copy libraries
COPY ./source/analitico /home/www/analitico/libs/analitico
COPY ./source/s24 /home/www/analitico/libs/s24
# copy script to launch jupyter
COPY ./scripts/docker-jupyter.sh /home/www/analitico
# use self signed certificates
COPY ./analitico-ci/ssl/analitico.ai.crt /home/www/analitico/analitico.ai.crt
COPY ./analitico-ci/ssl/analitico.ai.key /home/www/analitico/analitico.ai.key
# install new requirements, if any
RUN /bin/bash -c 'source venv/bin/activate;  pip3 install -r requirements.txt;'
# switch user
USER www
# create notebook folder
RUN /bin/bash -c 'mkdir -p /home/www/analitico/notebooks'