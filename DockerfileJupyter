FROM registry.gitlab.com/analitico/analitico:base
# we want to copy only requirements and ssl certificates
# execute everything as a new users with restricted access
RUN /bin/bash -c 'adduser --disabled-password --gecos "" analiticoj'
WORKDIR /home/analiticoj
#Â copy requirements
COPY ./requirements.txt /home/analiticoj
# copy script to launch jupyter
COPY ./scripts/docker-jupyter.sh /home/analiticoj
# copy ssl certificates
COPY ./analitico-ci/ssl/analitico.ai.crt /home/analiticoj
COPY ./analitico-ci/ssl/analitico.ai.key /home/analiticoj
# install new requirements, if any
RUN /bin/bash -c 'mv /home/www/analitico/venv /home/analiticoj/; source venv/bin/activate;  pip3 install -r requirements.txt'
# switch user
USER analiticoj
# create notebook folder
RUN /bin/bash -c 'mkdir -p ~/notebooks'